{% extends "base.html" %}
{% block title %}{{ rider.first_name }} {{ rider.last_name }} - Team Asha Randonneuring{% endblock %}

{% block extra_head %}
<style>
.advice-tip .advice-tooltip {
    display: none;
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background: #1a202c;
    color: #fff;
    font-size: 0.72rem;
    font-weight: 400;
    line-height: 1.5;
    padding: 8px 12px;
    border-radius: 8px;
    width: 240px;
    z-index: 10;
    box-shadow: 0 4px 12px rgba(0,0,0,.15);
    pointer-events: none;
}
.advice-tip .advice-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: #1a202c;
}
.advice-tip:hover .advice-tooltip {
    display: block;
}

/* Training card hover effects */
.training-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.1) !important;
    border-color: #cbd5e0 !important;
}
.activity-link:hover {
    color: #2c5282 !important;
    text-decoration: underline !important;
}

/* Upcoming ride card hover effects */
.upcoming-ride-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12) !important;
}
.advice-tip:hover {
    background: #f7fafc !important;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1) !important;
}
</style>
{% endblock %}

{% block content %}
<div class="hero" style="padding:30px 20px;">
{% if rider.photo_filename %}
<img src="{{ url_for('static', filename='riders/' + rider.photo_filename) }}" alt="{{ rider.first_name }} {{ rider.last_name }}" style="width:150px;height:150px;border-radius:50%;object-fit:cover;border:4px solid white;margin-bottom:15px;">
{% endif %}
<h1>{{ rider.first_name }} {{ rider.last_name }}</h1>
<p>RUSA# {{ rider.rusa_id }}</p>
</div>

<div class="stats-row">
<div class="stat-card"><div class="number">{{ career_rides }}</div><div class="label">Career Rides</div></div>
<div class="stat-card"><div class="number">{{ career_kms|commafy }}</div><div class="label">Career KMs</div></div>
{% if total_srs > 0 %}
<div class="stat-card"><div class="number" style="color:var(--accent);">{% if total_srs > 1 %}SR*{{ total_srs }}{% else %}SR{% endif %}</div><div class="label">Super Randonneur</div></div>
{% endif %}
{% if total_r12s > 0 %}
<div class="stat-card"><div class="number" style="color:#805ad5;">{% if total_r12s > 1 %}R-12*{{ total_r12s }}{% else %}R-12{% endif %}</div><div class="label">Randonneur 12</div></div>
{% endif %}
{% if rider.pbp_2023_status == 'Yes' %}
<div class="stat-card"><div class="number" style="font-size:1.4rem;"><span class="pbp-badge" style="font-size:1rem;">PBP 2023</span></div><div class="label">Paris-Brest-Paris</div></div>
{% endif %}
{% if fitness_score %}
<div class="stat-card"><div class="number" style="color:{% if fitness_score.total >= 70 %}#38a169{% elif fitness_score.total >= 40 %}#d69e2e{% else %}#e53e3e{% endif %};">{{ fitness_score.total }}</div><div class="label">Fitness Score</div></div>
{% endif %}
</div>

<div class="container section">
<a href="javascript:history.back()" class="back-link">&larr; Back</a>

{% if rider.bio %}
<div class="card">
<p>{{ rider.bio }}</p>
</div>
{% endif %}

{# ===== UPCOMING RIDES (COMPACT GRID) ===== #}
{% if upcoming_rides %}
<div style="margin-bottom:40px;">
    <div style="margin-bottom:20px; padding-bottom:12px; border-bottom:2px solid #e2e8f0;">
        <h3 style="color:var(--primary); margin:0 0 4px 0; font-size:1.5rem; font-weight:700;">Upcoming Rides</h3>
        <p style="margin:0; font-size:0.85rem; color:var(--text-light);">Rides you're signed up for</p>
    </div>
    <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:14px;">
    {% for ride in upcoming_rides %}
    <div class="upcoming-ride-card" style="display:flex; flex-direction:column; padding:14px 16px; background:white; border-radius:12px; border:2px solid {% if ride.is_soon %}#f59e0b{% else %}#e2e8f0{% endif %}; border-top:5px solid {% if ride.is_soon %}#f59e0b{% elif ride.readiness %}{{ ride.readiness.color }}{% else %}var(--primary){% endif %}; {% if ride.is_soon %}box-shadow: 0 4px 16px rgba(245, 158, 11, 0.25);{% else %}box-shadow: 0 2px 4px rgba(0,0,0,0.05);{% endif %} transition:all 0.2s ease;">
        <div style="margin-bottom:10px;">
            <div style="font-weight:700; font-size:0.9rem; color:var(--text); margin-bottom:6px; line-height:1.3;">
                {{ ride.name|clean_name }}
                {% if ride.signup_status == 'MAYBE' %}
                <span style="display:inline-block; font-size:0.65rem; font-weight:600; color:#d69e2e; background:#fef3c7; padding:2px 6px; border-radius:4px; margin-left:4px;">Maybe</span>
                {% endif %}
            </div>
            {% if ride.is_soon %}
            <div style="display:inline-flex; align-items:center; gap:4px; font-size:0.7rem; font-weight:700; color:#f59e0b; background:#fff7ed; padding:4px 8px; border-radius:6px; margin-bottom:8px;">
                <span style="font-size:0.9rem;">üîî</span>
                <span>{{ ride.days_until }} day{% if ride.days_until != 1 %}s{% endif %} away</span>
            </div>
            {% endif %}
            <div style="display:flex; flex-wrap:wrap; gap:8px; font-size:0.75rem; color:var(--text-light); margin-bottom:4px;">
                <span style="display:inline-flex; align-items:center; gap:3px; font-weight:600;">
                    üìÖ {{ ride.date }}{% if ride.start_time %} {{ ride.start_time }}{% endif %}
                </span>
            </div>
            <div style="display:flex; flex-wrap:wrap; gap:10px; font-size:0.75rem; color:var(--text-light);">
                {% if ride.distance_miles %}
                <span style="display:inline-flex; align-items:center; gap:3px;">
                    <span style="font-weight:600; color:var(--text);">{{ ride.distance_miles|round(0)|int }}</span> mi
                </span>
                {% elif ride.distance_km %}
                <span style="display:inline-flex; align-items:center; gap:3px;">
                    <span style="font-weight:600; color:var(--text);">{{ (ride.distance_km * 0.621371)|round(0)|int }}</span> mi
                </span>
                {% endif %}
                {% if ride.elevation_ft %}
                <span style="display:inline-flex; align-items:center; gap:3px;">
                    <span style="font-weight:600; color:var(--text);">{{ "{:,}".format(ride.elevation_ft) }}</span> ft
                </span>
                {% endif %}
            </div>
        </div>
        
        {# Start Location #}
        {% if ride.start_location %}
        <div style="font-size:0.75rem; color:var(--text-light); margin-bottom:10px; padding:6px 8px; background:#f7fafc; border-radius:6px; border-left:3px solid var(--primary);">
            <span style="font-weight:600; color:var(--text);">üìç</span> {{ ride.start_location }}
        </div>
        {% endif %}
        
        {% if ride.readiness or ride.advice %}
        <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-bottom:12px; padding:8px; background:#f7fafc; border-radius:8px;">
        {% if ride.readiness %}
            <div style="display:inline-flex; align-items:center; gap:6px;">
                <div style="width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:900; color:white; background:{{ ride.readiness.color }}; box-shadow:0 2px 4px rgba(0,0,0,0.15);">
                    {{ ride.readiness.score }}
                </div>
                <div style="display:inline-block; padding:4px 10px; border-radius:12px; font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:white; background:{{ ride.readiness.color }};">
                    {% if ride.readiness.level == 'ready' %}‚úì Ready{% elif ride.readiness.level == 'caution' %}‚ö†Ô∏è Needs Work{% else %}‚ö†Ô∏è Not Ready{% endif %}
                </div>
            </div>
        {% endif %}
            {% if ride.advice %}
            <span class="advice-tip" style="position:relative; cursor:pointer; display:inline-flex; align-items:center; background:white; padding:4px 8px; border-radius:8px; border:1px solid #e2e8f0; transition:all 0.2s;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="{% if ride.readiness %}{{ ride.readiness.color }}{% else %}var(--primary){% endif %}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/><circle cx="8" cy="10" r="1" fill="{% if ride.readiness %}{{ ride.readiness.color }}{% else %}var(--primary){% endif %}"/><circle cx="12" cy="10" r="1" fill="{% if ride.readiness %}{{ ride.readiness.color }}{% else %}var(--primary){% endif %}"/><circle cx="16" cy="10" r="1" fill="{% if ride.readiness %}{{ ride.readiness.color }}{% else %}var(--primary){% endif %}"/></svg>
                <span style="font-size:0.65rem; margin-left:4px; font-weight:600; color:{% if ride.readiness %}{{ ride.readiness.color }}{% else %}var(--primary){% endif %};">Advice</span>
                <span class="advice-tooltip">{% for tip in ride.advice %}{{ tip }}{% if not loop.last %}<br><br>{% endif %}{% endfor %}</span>
            </span>
            {% endif %}
        </div>
        {% endif %}
        
        {# Ride Plan and Route Links - Pushed to bottom #}
        <div style="display:flex; gap:6px; margin-top:auto; padding-top:8px; border-top:1px solid #f1f5f9; flex-wrap:wrap;">
            {% if ride.plan_slug %}
            <a href="{{ url_for('riders.ride_plan_detail', slug=ride.plan_slug) }}" style="display:inline-flex; align-items:center; gap:4px; padding:5px 10px; border-radius:6px; font-size:0.7rem; font-weight:600; text-decoration:none; background:linear-gradient(135deg,#f0f4ff,#e8f0fe); border:1px solid #c7d2fe; color:#4338ca; transition:all 0.2s;">
                üìç Ride Plan
            </a>
            {% else %}
                {% if ride.plan_rwgps_url_team %}
                <a href="{{ ride.plan_rwgps_url_team }}" target="_blank" style="display:inline-flex; align-items:center; gap:4px; padding:5px 10px; border-radius:6px; font-size:0.7rem; font-weight:600; text-decoration:none; background:linear-gradient(135deg,#fff7ed,#ffedd5); border:1px solid #ff6b00; color:#c2410c; transition:all 0.2s;">
                    <img src="https://ridewithgps.com/favicon.ico" alt="" style="width:14px;height:14px;">
                    Team Route
                </a>
                {% endif %}
                
                {% if ride.rwgps_url %}
                <a href="{{ ride.rwgps_url }}" target="_blank" style="display:inline-flex; align-items:center; gap:4px; padding:5px 10px; border-radius:6px; font-size:0.7rem; font-weight:600; text-decoration:none; background:linear-gradient(135deg,#f0f9ff,#e0f2fe); border:1px solid #7dd3fc; color:#0369a1; transition:all 0.2s;">
                    <img src="https://ridewithgps.com/favicon.ico" alt="" style="width:14px;height:14px;">
                    Route
                </a>
                {% endif %}
            {% endif %}
        </div>
    </div>
    {% endfor %}
    </div>
</div>
{% endif %}

{# ===== RECENT TRAINING (STRAVA) ===== #}
{% if has_strava and training_rides %}
<div style="margin-bottom:40px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:12px; padding-bottom:12px; border-bottom:2px solid #e2e8f0;">
        <div>
            <h3 style="color:var(--primary); margin:0 0 4px 0; font-size:1.5rem; font-weight:700;">Recent Training</h3>
            <p style="margin:0; font-size:0.85rem; color:var(--text-light);">Last 28 days of activity</p>
        </div>
        <img src="{{ url_for('static', filename='img/powered_by_strava.svg') }}" alt="Powered by Strava" style="height:28px; opacity:0.9;">
    </div>

    {# Fitness Score Breakdown #}
    {% if fitness_score %}
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(110px, 1fr)); gap:12px; margin-bottom:24px; padding:18px; background:linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); border-radius:12px; border:1px solid #e2e8f0; box-shadow:0 2px 4px rgba(0,0,0,0.04);">
        <div style="text-align:center; padding:8px; background:white; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08);">
            <div style="font-size:2.2rem; font-weight:900; background:linear-gradient(135deg, {% if fitness_score.total >= 70 %}#38a169, #48bb78{% elif fitness_score.total >= 40 %}#d69e2e, #ed8936{% else %}#e53e3e, #fc8181{% endif %}); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;">{{ fitness_score.total }}</div>
            <div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; font-weight:600; margin-top:2px;">Overall</div>
        </div>
        <div style="text-align:center; padding:8px;">
            <div style="font-size:1.3rem; font-weight:800; color:var(--primary);">{{ fitness_score.frequency }}</div>
            <div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; font-weight:500;">Frequency</div>
            <div style="font-size:0.6rem; color:#a0aec0; margin-top:1px;">/25</div>
        </div>
        <div style="text-align:center; padding:8px;">
            <div style="font-size:1.3rem; font-weight:800; color:var(--primary);">{{ fitness_score.volume }}</div>
            <div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; font-weight:500;">Volume</div>
            <div style="font-size:0.6rem; color:#a0aec0; margin-top:1px;">/35</div>
        </div>
        <div style="text-align:center; padding:8px;">
            <div style="font-size:1.3rem; font-weight:800; color:var(--primary);">{{ fitness_score.intensity }}</div>
            <div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; font-weight:500;">Intensity</div>
            <div style="font-size:0.6rem; color:#a0aec0; margin-top:1px;">/25</div>
        </div>
        <div style="text-align:center; padding:8px;">
            <div style="font-size:1.3rem; font-weight:800; color:var(--primary);">{{ fitness_score.recency }}</div>
            <div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; font-weight:500;">Recency</div>
            <div style="font-size:0.6rem; color:#a0aec0; margin-top:1px;">/15</div>
        </div>
    </div>
    {% endif %}

    {# Training Rides Card Grid #}
    <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:14px;">
    {% for ride in training_rides %}
    <div class="training-card" style="padding:14px; background:white; border-radius:12px; border:1px solid #e2e8f0; border-left:5px solid {{ ride.color }}; position:relative; transition:all 0.2s ease; box-shadow:0 1px 3px rgba(0,0,0,0.05);">
        {# Grade badge - top right #}
        <div style="position:absolute; top:12px; right:12px;">
            <span style="display:inline-flex; align-items:center; justify-content:center; min-width:36px; height:24px; padding:0 8px; border-radius:12px; font-size:0.75rem; font-weight:800; color:white; background:{{ ride.color }}; text-align:center; box-shadow:0 2px 4px rgba(0,0,0,0.1);" title="Score: {{ ride.total }}/100">
                {{ ride.grade }}{% if ride.trend == 'building' %} <span style="font-size:0.6rem; margin-left:2px;">‚ñ≤</span>{% elif ride.trend == 'declining' %} <span style="font-size:0.6rem; margin-left:2px;">‚ñº</span>{% endif %}
            </span>
        </div>
        {# Activity name #}
        <div style="font-weight:600; font-size:0.85rem; color:var(--text); margin-bottom:5px; line-height:1.3; padding-right:50px;">
            <a href="{{ ride.strava_url or ('https://www.strava.com/activities/' ~ ride.strava_activity_id) }}" target="_blank" rel="noopener" style="color:var(--primary); text-decoration:none; transition:color 0.2s;" title="View on Strava" class="activity-link">
                {{ ride.name or 'Ride' }}
            </a>
        </div>
        {# Date #}
        <div style="font-size:0.72rem; color:var(--text-light); margin-bottom:8px; font-weight:500;">
            {% if ride.start_date_local %}
                {{ ride.start_date_local.strftime('%b %d, %Y') if ride.start_date_local is not string else ride.start_date_local[:10] }}
            {% endif %}
        </div>
        {# Metrics #}
        <div style="font-size:0.8rem; color:var(--text); line-height:1.7; background:#f7fafc; padding:8px; border-radius:8px; margin-bottom:6px;">
            <div style="display:flex; align-items:center; gap:6px; margin-bottom:3px;">
                <span style="font-weight:600;">{{ ((ride.distance or 0) / 1609.34)|round(1) }}</span> 
                <span style="color:var(--text-light); font-size:0.7rem;">mi</span>
                <span style="color:#cbd5e0; margin:0 4px;">|</span>
                <span style="font-weight:600;">{{ "{:,}".format(((ride.total_elevation_gain or 0) * 3.28084)|round(0)|int) }}</span>
                <span style="color:var(--text-light); font-size:0.7rem;">ft</span>
            </div>
            <div style="color:#718096; font-size:0.75rem;">
                {% if ride.moving_time %}
                    {% set hrs = (ride.moving_time // 3600)|int %}
                    {% set mins = ((ride.moving_time % 3600) // 60)|int %}
                    ‚è±Ô∏è {% if hrs > 0 %}{{ hrs }}h {{ mins }}m{% else %}{{ mins }}m{% endif %}
                {% endif %}
            </div>
        </div>
        {# HR/Power footer #}
        {% if (ride.has_heartrate and ride.average_heartrate) or (ride.device_watts and ride.average_watts) %}
        <div style="display:flex; gap:10px; font-size:0.7rem; color:var(--text-light); padding-top:6px; border-top:1px solid #edf2f7;">
            {% if ride.has_heartrate and ride.average_heartrate %}
            <span style="display:inline-flex; align-items:center; gap:3px;" title="Average Heart Rate">
                <span style="color:#e53e3e;">‚ù§Ô∏è</span>
                <span style="font-weight:600; color:var(--text);">{{ ride.average_heartrate|round(0)|int }}</span>
                <span style="font-size:0.65rem;">bpm</span>
            </span>
            {% endif %}
            {% if ride.device_watts and ride.average_watts %}
            <span style="display:inline-flex; align-items:center; gap:3px;" title="Average Power">
                <span style="color:#f59e0b;">‚ö°</span>
                <span style="font-weight:600; color:var(--text);">{{ ride.average_watts|round(0)|int }}</span>
                <span style="font-size:0.65rem;">W</span>
            </span>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
    </div>
</div>
{% endif %}

{# ===== BREVET SEASON HISTORY ===== #}
{% for sd in season_data %}
<div class="season-block" style="margin-bottom:35px; background:white; border-radius:12px; padding:24px; box-shadow:0 2px 8px rgba(0,0,0,0.06); border-left:5px solid var(--primary);">
<div style="margin-bottom:16px; padding-bottom:16px; border-bottom:2px solid #f1f5f9;">
    <h3 style="margin:0 0 12px 0; font-size:1.4rem; font-weight:700; color:var(--primary); display:flex; align-items:center; flex-wrap:wrap; gap:10px;">
        <span>{{ sd.season.name }} Season</span>
        {% if sd.sr_count > 0 %}
        <span class="sr-badge" style="background:linear-gradient(135deg, #4facfe, #00f2fe); padding:4px 12px; border-radius:10px; font-size:0.8rem; box-shadow:0 2px 6px rgba(0,0,0,0.12);">{% if sd.sr_count > 1 %}SR√ó{{ sd.sr_count }}{% else %}SR{% endif %}</span>
        {% endif %}
        {% set season_years = sd.season.name.split('-') %}
        {% set r12_in_season = [] %}
        {% for award in r12_awards %}{% if award.end_year|string in season_years %}{% if r12_in_season.append(1) %}{% endif %}{% endif %}{% endfor %}
        {% if r12_in_season|length > 0 %}
        <span style="display:inline-block; padding:4px 12px; border-radius:10px; font-size:0.8rem; font-weight:700; color:white; background:linear-gradient(135deg, #a8edea, #fed6e3); color:#805ad5; box-shadow:0 2px 6px rgba(0,0,0,0.12);">{% if r12_in_season|length > 1 %}R-12√ó{{ r12_in_season|length }}{% else %}R-12{% endif %}</span>
        {% endif %}
        {% if sd.season.name == '2022-2023' and rider.pbp_2023_status == 'Yes' %}
        <span class="pbp-badge" style="background:linear-gradient(135deg, #ff6b6b, #ee5a6f); padding:4px 12px; border-radius:10px; font-size:0.8rem; box-shadow:0 2px 6px rgba(0,0,0,0.12);">PBP Finisher</span>
        {% endif %}
        {% if sd.season.name == '2022-2023' and rider.pbp_2023_status == 'DNF' %}
        <span class="badge badge-dnf" style="padding:4px 12px; border-radius:10px; font-size:0.8rem;">PBP DNF</span>
        {% endif %}
    </h3>
    <div style="display:flex; gap:20px; flex-wrap:wrap; font-size:0.9rem;">
        <div style="display:flex; align-items:center; gap:6px;">
            <span style="color:var(--text-light);">Rides:</span>
            <span style="font-weight:700; color:var(--primary); font-size:1.1rem;">{{ sd.rides }}</span>
        </div>
        <div style="display:flex; align-items:center; gap:6px;">
            <span style="color:var(--text-light);">Distance:</span>
            <span style="font-weight:700; color:var(--primary); font-size:1.1rem;">{{ sd.kms|commafy }} km</span>
        </div>
    </div>
</div>

<div class="table-wrap" style="margin-top:0; overflow-x:auto;">
<table style="width:100%; border-collapse:separate; border-spacing:0;">
<thead>
<tr style="background:linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);">
    <th style="padding:12px 16px; text-align:left; font-weight:700; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.5px; color:var(--text); border-bottom:2px solid #e2e8f0; border-top-left-radius:8px;">Date</th>
    <th style="padding:12px 16px; text-align:left; font-weight:700; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.5px; color:var(--text); border-bottom:2px solid #e2e8f0;">Event</th>
    <th style="padding:12px 16px; text-align:left; font-weight:700; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.5px; color:var(--text); border-bottom:2px solid #e2e8f0;">Distance</th>
    <th style="padding:12px 16px; text-align:left; font-weight:700; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.5px; color:var(--text); border-bottom:2px solid #e2e8f0;">Elevation</th>
    <th style="padding:12px 16px; text-align:center; font-weight:700; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.5px; color:var(--text); border-bottom:2px solid #e2e8f0; border-top-right-radius:8px;">Time</th>
</tr>
</thead>
<tbody>
{% for p in sd.participation %}
{% if p.status|lower == 'finished' or p.status|lower == 'dnf' %}
<tr style="transition:background 0.2s;" onmouseover="this.style.background='#f7fafc'" onmouseout="this.style.background='white'">
<td style="padding:14px 16px; border-bottom:1px solid #f1f5f9; font-size:0.85rem; color:var(--text-light); font-weight:500;">{{ p.date }}</td>
<td style="padding:14px 16px; border-bottom:1px solid #f1f5f9; font-size:0.85rem; color:var(--text); line-height:1.5;">
    <strong style="color:var(--primary);">{{ p.ride_name|clean_name }}</strong>
    {% if p.rwgps_url %}
    <a href="{{ p.rwgps_url }}" target="_blank" style="display:inline-flex; align-items:center; gap:3px; margin-left:8px; font-size:0.75rem; color:#4299e1; text-decoration:none; padding:2px 6px; border-radius:4px; background:#ebf8ff; transition:all 0.2s;">
        <img src="https://ridewithgps.com/favicon.ico" alt="" style="width:12px;height:12px;">
        route
    </a>
    {% endif %}
    {% if p.status|lower == 'dnf' %}
    <span class="badge badge-dnf" style="display:inline-block; margin-left:6px; padding:2px 8px; border-radius:6px; font-size:0.7rem; font-weight:600;">DNF</span>
    {% endif %}
</td>
<td style="padding:14px 16px; border-bottom:1px solid #f1f5f9; font-size:0.85rem; font-weight:600; color:var(--text);">{{ p.distance_km }} km</td>
<td style="padding:14px 16px; border-bottom:1px solid #f1f5f9; font-size:0.85rem; color:var(--text-light);">{% if p.elevation_ft %}<span style="font-weight:600; color:var(--text);">{{ "{:,}".format(p.elevation_ft) }}</span> ft{% endif %}</td>
<td style="padding:14px 16px; border-bottom:1px solid #f1f5f9; text-align:center; font-size:0.85rem; color:#718096; font-weight:600; font-family:monospace;">{{ p.finish_time or '‚Äî' }}</td>
</tr>
{% endif %}
{% endfor %}
</tbody>
</table>
</div>
</div>
{% endfor %}


{% if session.get('logged_in') %}
<p style="margin-top:20px;"><a href="{{ url_for('riders.rider_edit', rusa_id=rider.rusa_id) }}" class="btn btn-primary btn-sm">Edit Profile</a></p>
{% endif %}

</div>
{% endblock %}
